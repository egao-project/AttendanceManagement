package action;

import javax.servlet.jsp.JspException;

import org.apache.struts.taglib.TagUtils;
import org.apache.struts.taglib.html.FormTag;
import org.apache.struts.taglib.html.SubmitTag;

public class DispatchSubmitTag extends SubmitTag {

	private static final long serialVersionUID = 1L;
	private String cmd = "";

	public String getCmd() {
		return cmd;
	}

	public void setCmd(String cmd) {
		this.cmd = cmd;
	}

	public String getOnclick() {
		String org = super.getOnclick();
		//親のFormタグを取得
		FormTag formTag = (FormTag)findAncestorWithClass(this, FormTag.class);
		//onclickスクリプトを変更
		StringBuffer buff = new StringBuffer();
		buff.append(formTag.getBeanName());
		buff.append(".cmd.value='");
		buff.append(cmd);
		buff.append("';");
		buff.append(org == null ? "" : org);
		return buff.toString();
	}

	@Override
	public int doEndTag() throws JspException {

		//最初にDispatchSubmitTagが出力されたときにhiddenタグを出力する
		if (pageContext.getAttribute(SubmitTag.class.getName()) == null){
			TagUtils.getInstance().write(this.pageContext, "<input type='hidden' name='cmd' />");
			pageContext.setAttribute(SubmitTag.class.getName(), Boolean.TRUE);
		}
		return super.doEndTag();
	}
}